<script>
let lastEvent = null;

function getConfig() {
  return JSON.parse(localStorage.getItem("alertConfig")) || {
    text: "❤️ {name} supported ₹{amount}",
    fontSize: 28,
    color: "#ffffff",
    sound: "",
    gif: ""
  };
}

async function poll() {
  try {
    const r = await fetch("http://localhost:8000/latest");
    const d = await r.json();
    if (!d.name || !d.amount) return;

    const key = JSON.stringify(d);
    if (key === lastEvent) return;
    lastEvent = key;

    showAlert(d.name, d.amount);
  } catch {}
}

function showAlert(name, amount) {
  const cfg = getConfig();
  const box = document.getElementById("container");
  const txt = document.getElementById("text");
  const gif = document.getElementById("gif");
  const snd = document.getElementById("sound");

  txt.innerHTML = cfg.text
    .replace("{name}", name)
    .replace("{amount}", amount);
  txt.style.fontSize = cfg.fontSize + "px";
  txt.style.color = cfg.color;

  if (cfg.gif) {
    gif.src = cfg.gif;
    gif.style.display = "block";
  } else gif.style.display = "none";

  if (cfg.sound) {
    snd.src = cfg.sound;
    snd.currentTime = 0;
    snd.play();
  }

  box.classList.add("show");
  setTimeout(() => box.classList.remove("show"), 5000);
}

setInterval(poll, 2000);
</script>
