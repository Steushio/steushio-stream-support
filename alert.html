<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Steushio Stream Alert</title>

<style>
  body {
    margin: 0;
    background: transparent;
    overflow: hidden;
    font-family: Arial, Helvetica, sans-serif;
  }

  #alert {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.8);
    padding: 24px 36px;
    background: rgba(0, 0, 0, 0.75);
    color: #fff;
    border-radius: 18px;
    font-size: 28px;
    font-weight: bold;
    opacity: 0;
    transition: all 0.45s ease;
    box-shadow: 0 0 35px rgba(255,255,255,0.2);
    text-align: center;
    white-space: nowrap;
  }

  #alert.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
</style>
</head>

<body>

<div id="alert"></div>

<!-- Alert sound -->
<audio id="alertSound" src="alert.mp3" preload="auto"></audio>

<script>
let lastEvent = null;

async function pollAlert() {
  try {
    const res = await fetch("http://localhost:8000/latest");
    const data = await res.json();

    if (!data || !data.name) return;

    const eventKey = JSON.stringify(data);
    if (eventKey === lastEvent) return;

    lastEvent = eventKey;
    showAlert(data.name, data.amount);
  } catch (e) {
    // silently ignore connection errors
  }
}

function showAlert(name, amount) {
  const alertBox = document.getElementById("alert");
  const sound = document.getElementById("alertSound");

  alertBox.innerHTML = `❤️ <span>${name}</span> supported the stream`;
  alertBox.classList.add("show");

  sound.currentTime = 0;
  sound.play();

  setTimeout(() => {
    alertBox.classList.remove("show");
  }, 5000);
}

// check every 2 seconds
setInterval(pollAlert, 2000);
</script>

</body>
</html>
